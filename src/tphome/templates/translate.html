{% extends 'base.html' %}

{% block title %}Translate Page{% endblock title %}


{% block content %}


<section class="bg-gray-100 dark:bg-gray-900 p-4 pt-24 pb-24">
  <form method="post", id="translateForm">
    {% csrf_token %}
  <div class="max-w-4xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
    <div class="p-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

        <!-- Language selection dropdowns -->
        <div class="relative">

          <select type="text" id="language1" class="hidden" name="language1" required>
            <option value="">Translate From</option>
            {% for language in languages %}
              <option value="{{ language }}">{{ language }}</option>
            {% endfor %}
          </select>

          <div class="custom-select w-full">
            <div class="select-selected w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white cursor-pointer">Translate From</div>
            <div class="select-items hidden absolute z-10 left-0 right-0 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md mt-1 max-h-60 overflow-y-auto">
              <input type="text" class="w-full p-2 border-b border-gray-300 dark:border-gray-600" placeholder="Search languages...">
              {% for language in languages %}
                <div class="p-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600">{{ language }}</div>
              {% endfor %}
            </div>
          </div>
        </div>

        <div class="flex flex-col sm:flex-row">
          <div class="relative flex-grow mb-4 sm:mb-0">
            <select type="text" id="language2" class="hidden" name="language2" required>
              <option value="">Translate to</option>
              {% for language in languages %}
                <option value="{{ language }}">{{ language }}</option>
              {% endfor %}
            </select>
            <div class="custom-select w-full">
              <div class="select-selected w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white cursor-pointer">Translate To</div>
              <div class="select-items hidden absolute z-10 left-0 right-0 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md mt-1 max-h-60 overflow-y-auto">
                <input type="text" class="w-full p-2 border-b border-gray-300 dark:border-gray-600" placeholder="Search languages...">
                {% for language in languages %}
                  <div class="p-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600">{{ language }}</div>
                {% endfor %}
              </div>
            </div>
          </div>

          <select type="text" id="tone" name ="tone" class="w-full sm:w-auto sm:ml-4 p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
            <option value="Normal">Select Tone</option>
            <option value="Normal"><strong>Normal</strong></option>
            <option value="Exaggertion"> Exaggertion </option>
            <option value="Formal"> Formal </option>
            <option value="Polite"> Happy </option>
            <option value="Sarcastic"> Sarcastic </option>
            <option value="Serious"> Serious </option>

            
          </select>

        </div>
      </div>
      
      <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Input text area -->
        <div>
          <textarea id="inputText" name="inputText" rows="8" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="Type here to translate. Select the tone you want to translate in. Default tone is set to 'Normal'..." required></textarea>
          <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
            Select the tone you want to translate in. Default tone is set to 'Normal'
          </p>
        </div>
        
        <!-- Output text area -->
        <div>
          <div id="outputText" name="outputText" class="h-[215px] bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md p-2 overflow-y-auto">{{output}}</div>
        </div>
      </div>
      
      <!-- Translate button -->
      <div class="mt-4 flex justify-end">
        <button type="submit" id="translateBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md">
          Translate Now !
        </button>
      </div>
    </div>
  </div>
</form>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('translateForm');
    const outputDiv = document.getElementById('outputText');
    const translateBtn = document.getElementById('translateBtn');
  
    // Custom select functionality
    const customSelects = document.querySelectorAll('.custom-select');
    
    customSelects.forEach(select => {
      const selected = select.querySelector('.select-selected');
      const items = select.querySelector('.select-items');
      const searchInput = items.querySelector('input');
      const options = items.querySelectorAll('div:not(:first-child)');
      
      selected.addEventListener('click', () => {
        items.classList.toggle('hidden');
      });
      
      searchInput.addEventListener('input', () => {
        const filter = searchInput.value.toLowerCase();
        options.forEach(option => {
          const text = option.textContent.toLowerCase();
          option.style.display = text.includes(filter) ? '' : 'none';
        });
      });
      
      options.forEach(option => {
        option.addEventListener('click', () => {
          selected.textContent = option.textContent;
          items.classList.add('hidden');
          const selectElement = select.previousElementSibling;
          selectElement.value = option.textContent;
          selectElement.dispatchEvent(new Event('change'));
        });
      });
    });
  
    // Translation functionality
    translateBtn.addEventListener('click', function(e) {
      e.preventDefault();
      
      translateBtn.disabled = true;
      translateBtn.textContent = 'Translating...';
      
      const formData = new FormData(form);
  
      fetch('{% url "translate" %}', {
        method: 'POST',
        body: formData,
        headers: {
          'X-Requested-With': 'XMLHttpRequest',
          'X-CSRFToken': formData.get('csrfmiddlewaretoken')
        }
      })
      .then(response => response.json())
      .then(data => {
        outputDiv.textContent = data.output;
      })
      .catch(error => {
        console.error('Error:', error);
        outputDiv.textContent = 'An error occurred during translation.';
      })
      .finally(() => {
        translateBtn.disabled = false;
        translateBtn.textContent = 'Translate Now !';
      });
    });
  
    // Close custom select when clicking outside
    document.addEventListener('click', function(e) {
      customSelects.forEach(select => {
        const items = select.querySelector('.select-items');
        if (!select.contains(e.target)) {
          items.classList.add('hidden');
        }
      });
    });
  });
  </script>

{% endblock %}
